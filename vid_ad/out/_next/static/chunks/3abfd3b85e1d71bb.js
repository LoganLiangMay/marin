(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,88236,e=>{"use strict";var t=e.i(89589),a=e.i(59694);e.i(64752);var r=e.i(66870),s=e.i(39555);e.i(59539);var i=e.i(22008);let o=(0,a.createContext)(void 0);function l(){let e=(0,a.useContext)(o);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}function n({children:e}){let[l,n]=(0,a.useState)(null),[u,d]=(0,a.useState)(null),[c,m]=(0,a.useState)(!0),[h,p]=(0,a.useState)(null),w=async(e,t)=>{if(!e)return;let a=(0,i.doc)(s.firestore,"users",e.uid),r=await (0,i.getDoc)(a);if(r.exists()){await (0,i.updateDoc)(a,{lastLogin:(0,i.serverTimestamp)()});let t=r.data();d({uid:e.uid,email:t.email,displayName:t.displayName,photoURL:t.photoURL,createdAt:t.createdAt?.toDate(),lastLogin:t.lastLogin?.toDate(),metadata:t.metadata})}else{let r={uid:e.uid,email:e.email,displayName:e.displayName||t?.displayName||null,photoURL:e.photoURL,createdAt:new Date,lastLogin:new Date,...t};try{await (0,i.setDoc)(a,{...r,createdAt:(0,i.serverTimestamp)(),lastLogin:(0,i.serverTimestamp)()}),d(r)}catch(e){console.error("Error creating user profile:",e),p("Failed to create user profile")}}},g=async(e,t,a)=>{p(null);try{let i=await (0,r.createUserWithEmailAndPassword)(s.auth,e,t);return a&&i.user&&await (0,r.updateProfile)(i.user,{displayName:a}),await w(i.user,{displayName:a}),i}catch(e){throw p(e.message),e}},y=async(e,t,a=!1)=>{p(null);try{await (0,r.setPersistence)(s.auth,a?r.browserLocalPersistence:r.browserSessionPersistence);let i=await (0,r.signInWithEmailAndPassword)(s.auth,e,t);return i.user&&(await w(i.user),a&&localStorage.setItem("sessionStartTime",new Date().toISOString())),i}catch(e){throw p(e.message),e}},f=async()=>{p(null);try{await (0,r.signOut)(s.auth),d(null),localStorage.removeItem("sessionStartTime")}catch(e){throw p(e.message),e}},v=()=>{let e=localStorage.getItem("sessionStartTime");if(e&&l){let t=new Date(e);(new Date().getTime()-t.getTime())/864e5>30&&(f(),p("Your session has expired after 30 days. Please log in again."))}},L=async e=>{p(null);try{await (0,r.sendPasswordResetEmail)(s.auth,e)}catch(e){throw p(e.message),e}},A=async e=>{if(!l)return void p("No user logged in");p(null);try{let t=(0,i.doc)(s.firestore,"users",l.uid);await (0,i.updateDoc)(t,e),d(t=>t?{...t,...e}:null),(void 0!==e.displayName||void 0!==e.photoURL)&&await (0,r.updateProfile)(l,{displayName:e.displayName||l.displayName,photoURL:e.photoURL||l.photoURL})}catch(e){throw p(e.message),e}};return(0,a.useEffect)(()=>{let e=(0,r.onAuthStateChanged)(s.auth,async e=>{if(n(e),e){let t=(0,i.doc)(s.firestore,"users",e.uid),a=await (0,i.getDoc)(t);if(a.exists()){let t=a.data();d({uid:e.uid,email:t.email,displayName:t.displayName,photoURL:t.photoURL,createdAt:t.createdAt?.toDate(),lastLogin:t.lastLogin?.toDate(),metadata:t.metadata})}else await w(e);v()}else d(null);m(!1)}),t=setInterval(()=>{v()},36e5);return()=>{e(),clearInterval(t)}},[]),(0,t.jsx)(o.Provider,{value:{currentUser:l,userProfile:u,loading:c,error:h,signup:g,login:y,logout:f,resetPassword:L,updateUserProfile:A,clearError:()=>p(null),checkSessionExpiry:v},children:e})}e.s(["AuthProvider",()=>n,"useAuth",()=>l])}]);