{"version":3,"sources":["turbopack:///[project]/marin/vid_ad/node_modules/next/src/server/route-modules/app-page/module.compiled.js","turbopack:///[project]/marin/vid_ad/node_modules/next/src/server/route-modules/app-page/vendored/ssr/react-jsx-runtime.ts","turbopack:///[project]/marin/vid_ad/node_modules/next/src/server/route-modules/app-page/vendored/ssr/react.ts","turbopack:///[project]/marin/vid_ad/lib/contexts/AuthContext.tsx"],"sourcesContent":["if (process.env.NEXT_RUNTIME === 'edge') {\n  module.exports = require('next/dist/server/route-modules/app-page/module.js')\n} else {\n  if (process.env.__NEXT_EXPERIMENTAL_REACT) {\n    if (process.env.NODE_ENV === 'development') {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo-experimental.runtime.dev.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page-experimental.runtime.dev.js')\n      }\n    } else {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo-experimental.runtime.prod.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page-experimental.runtime.prod.js')\n      }\n    }\n  } else {\n    if (process.env.NODE_ENV === 'development') {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo.runtime.dev.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page.runtime.dev.js')\n      }\n    } else {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo.runtime.prod.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page.runtime.prod.js')\n      }\n    }\n  }\n}\n","module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['react-ssr']!.ReactJsxRuntime\n","module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['react-ssr']!.React\n","'use client';\n\nimport React, { createContext, useContext, useState, useEffect } from 'react';\nimport {\n  User,\n  createUserWithEmailAndPassword,\n  signInWithEmailAndPassword,\n  signOut,\n  onAuthStateChanged,\n  sendPasswordResetEmail,\n  updateProfile,\n  UserCredential,\n  setPersistence,\n  browserLocalPersistence,\n  browserSessionPersistence\n} from 'firebase/auth';\nimport { auth, firestore as db } from '@/lib/firebase/config';\nimport { doc, setDoc, getDoc, updateDoc, serverTimestamp } from 'firebase/firestore';\n\n// TypeScript interfaces\ninterface UserProfile {\n  uid: string;\n  email: string | null;\n  displayName: string | null;\n  photoURL: string | null;\n  createdAt: Date;\n  lastLogin: Date;\n  metadata?: Record<string, any>;\n}\n\ninterface AuthContextType {\n  currentUser: User | null;\n  userProfile: UserProfile | null;\n  loading: boolean;\n  error: string | null;\n  signup: (email: string, password: string, displayName?: string) => Promise<UserCredential>;\n  login: (email: string, password: string, rememberMe?: boolean) => Promise<UserCredential>;\n  logout: () => Promise<void>;\n  resetPassword: (email: string) => Promise<void>;\n  updateUserProfile: (data: Partial<UserProfile>) => Promise<void>;\n  clearError: () => void;\n  checkSessionExpiry: () => void;\n}\n\n// Create context\nconst AuthContext = createContext<AuthContextType | undefined>(undefined);\n\n// Custom hook to use auth context\nexport function useAuth() {\n  const context = useContext(AuthContext);\n  if (context === undefined) {\n    throw new Error('useAuth must be used within an AuthProvider');\n  }\n  return context;\n}\n\n// Auth Provider component\nexport function AuthProvider({ children }: { children: React.ReactNode }) {\n  const [currentUser, setCurrentUser] = useState<User | null>(null);\n  const [userProfile, setUserProfile] = useState<UserProfile | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  // Create user profile in Firestore\n  const createUserProfile = async (user: User, additionalData?: Partial<UserProfile>) => {\n    if (!user) return;\n\n    const userRef = doc(db, 'users', user.uid);\n    const snapshot = await getDoc(userRef);\n\n    if (!snapshot.exists()) {\n      const profile: UserProfile = {\n        uid: user.uid,\n        email: user.email,\n        displayName: user.displayName || additionalData?.displayName || null,\n        photoURL: user.photoURL,\n        createdAt: new Date(),\n        lastLogin: new Date(),\n        ...additionalData\n      };\n\n      try {\n        await setDoc(userRef, {\n          ...profile,\n          createdAt: serverTimestamp(),\n          lastLogin: serverTimestamp()\n        });\n        setUserProfile(profile);\n      } catch (err) {\n        console.error('Error creating user profile:', err);\n        setError('Failed to create user profile');\n      }\n    } else {\n      // Update last login\n      await updateDoc(userRef, {\n        lastLogin: serverTimestamp()\n      });\n      const data = snapshot.data();\n      setUserProfile({\n        uid: user.uid,\n        email: data.email,\n        displayName: data.displayName,\n        photoURL: data.photoURL,\n        createdAt: data.createdAt?.toDate(),\n        lastLogin: data.lastLogin?.toDate(),\n        metadata: data.metadata\n      });\n    }\n  };\n\n  // Signup function\n  const signup = async (email: string, password: string, displayName?: string) => {\n    setError(null);\n    try {\n      const result = await createUserWithEmailAndPassword(auth, email, password);\n\n      // Update display name if provided\n      if (displayName && result.user) {\n        await updateProfile(result.user, { displayName });\n      }\n\n      // Create user profile in Firestore\n      await createUserProfile(result.user, { displayName });\n\n      return result;\n    } catch (err: any) {\n      setError(err.message);\n      throw err;\n    }\n  };\n\n  // Login function with remember me option\n  const login = async (email: string, password: string, rememberMe: boolean = false) => {\n    setError(null);\n    try {\n      // Set persistence based on remember me option\n      // If remember me is true, use LOCAL persistence (30 days)\n      // If false, use SESSION persistence (until browser closes)\n      await setPersistence(auth, rememberMe ? browserLocalPersistence : browserSessionPersistence);\n\n      const result = await signInWithEmailAndPassword(auth, email, password);\n\n      // Update user profile last login\n      if (result.user) {\n        await createUserProfile(result.user);\n\n        // Store session start time for 30-day expiry tracking\n        if (rememberMe) {\n          localStorage.setItem('sessionStartTime', new Date().toISOString());\n        }\n      }\n\n      return result;\n    } catch (err: any) {\n      setError(err.message);\n      throw err;\n    }\n  };\n\n  // Logout function\n  const logout = async () => {\n    setError(null);\n    try {\n      await signOut(auth);\n      setUserProfile(null);\n      // Clear session data\n      localStorage.removeItem('sessionStartTime');\n    } catch (err: any) {\n      setError(err.message);\n      throw err;\n    }\n  };\n\n  // Check if session has expired (30 days)\n  const checkSessionExpiry = () => {\n    const sessionStartTime = localStorage.getItem('sessionStartTime');\n    if (sessionStartTime && currentUser) {\n      const startDate = new Date(sessionStartTime);\n      const now = new Date();\n      const daysDifference = (now.getTime() - startDate.getTime()) / (1000 * 60 * 60 * 24);\n\n      // If more than 30 days have passed, force logout\n      if (daysDifference > 30) {\n        logout();\n        setError('Your session has expired after 30 days. Please log in again.');\n      }\n    }\n  };\n\n  // Reset password function\n  const resetPassword = async (email: string) => {\n    setError(null);\n    try {\n      await sendPasswordResetEmail(auth, email);\n    } catch (err: any) {\n      setError(err.message);\n      throw err;\n    }\n  };\n\n  // Update user profile\n  const updateUserProfile = async (data: Partial<UserProfile>) => {\n    if (!currentUser) {\n      setError('No user logged in');\n      return;\n    }\n\n    setError(null);\n    try {\n      const userRef = doc(db, 'users', currentUser.uid);\n      await updateDoc(userRef, data);\n\n      // Update local state\n      setUserProfile(prev => prev ? { ...prev, ...data } : null);\n\n      // Update Firebase Auth profile if displayName or photoURL changed\n      if (data.displayName !== undefined || data.photoURL !== undefined) {\n        await updateProfile(currentUser, {\n          displayName: data.displayName || currentUser.displayName,\n          photoURL: data.photoURL || currentUser.photoURL\n        });\n      }\n    } catch (err: any) {\n      setError(err.message);\n      throw err;\n    }\n  };\n\n  // Clear error\n  const clearError = () => setError(null);\n\n  // Set up auth state listener and session expiry checker\n  useEffect(() => {\n    const unsubscribe = onAuthStateChanged(auth, async (user) => {\n      setCurrentUser(user);\n\n      if (user) {\n        // Get user profile from Firestore\n        const userRef = doc(db, 'users', user.uid);\n        const snapshot = await getDoc(userRef);\n\n        if (snapshot.exists()) {\n          const data = snapshot.data();\n          setUserProfile({\n            uid: user.uid,\n            email: data.email,\n            displayName: data.displayName,\n            photoURL: data.photoURL,\n            createdAt: data.createdAt?.toDate(),\n            lastLogin: data.lastLogin?.toDate(),\n            metadata: data.metadata\n          });\n        } else {\n          // Create profile if it doesn't exist\n          await createUserProfile(user);\n        }\n\n        // Check session expiry on auth state change\n        checkSessionExpiry();\n      } else {\n        setUserProfile(null);\n      }\n\n      setLoading(false);\n    });\n\n    // Set up interval to check session expiry every hour\n    const intervalId = setInterval(() => {\n      checkSessionExpiry();\n    }, 60 * 60 * 1000); // Check every hour\n\n    return () => {\n      unsubscribe();\n      clearInterval(intervalId);\n    };\n  }, []);\n\n  const value: AuthContextType = {\n    currentUser,\n    userProfile,\n    loading,\n    error,\n    signup,\n    login,\n    logout,\n    resetPassword,\n    updateUserProfile,\n    clearError,\n    checkSessionExpiry\n  };\n\n  return (\n    <AuthContext.Provider value={value}>\n      {children}\n    </AuthContext.Provider>\n  );\n}"],"names":["process","env","NEXT_RUNTIME","module","exports","require","__NEXT_EXPERIMENTAL_REACT","NODE_ENV","TURBOPACK","vendored","ReactJsxRuntime","React"],"mappings":"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","ignoreList":[0,1,2]}