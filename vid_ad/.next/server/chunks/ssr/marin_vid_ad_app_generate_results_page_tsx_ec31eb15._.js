module.exports=[10855,a=>{"use strict";var b=a.i(6796),c=a.i(3160),d=a.i(91337),e=a.i(32575);a.i(99813);var f=a.i(97455),g=a.i(74330);class h{static instance;functions;MODELS={"seedance-1-lite":"bytedance/seedance-1-lite","seedance-1-pro":"bytedance/seedance-1-pro"};PRICING={"seedance-1-lite":{"480p":.018,"720p":.036,"1080p":.072},"seedance-1-pro":{"480p":.03,"720p":.06,"1080p":.15}};constructor(){this.functions=(0,f.getFunctions)(g.app),console.log("‚úÖ Firebase Functions initialized for Replicate video service")}static getInstance(){return h.instance||(h.instance=new h),h.instance}async generateVideo(a){console.log("üé¨ Replicate Video Generation Request:",a);let b=a.model||"seedance-1-lite",c=a.duration||6,d=a.resolution||"720p",e=a.aspectRatio||"16:9";try{let g=(0,f.httpsCallable)(this.functions,"generateReplicateVideo"),h=(await g({model:b,prompt:a.prompt,duration:c,aspectRatio:e,resolution:d,seed:a.seed,cameraFixed:a.cameraFixed,image:a.image,lastFrameImage:a.lastFrameImage,productName:a.productName,productDescription:a.productDescription,keywords:a.keywords,brandTone:a.brandTone,primaryColor:a.primaryColor,callToAction:a.callToAction,targetAudience:a.targetAudience})).data;console.log("‚úÖ Video generation initiated:",h.predictionId);let i=this.calculateCost(b,c,d);return{id:h.predictionId,url:"",thumbnail:"",duration:c,status:this.mapStatus(h.status||"starting"),progress:0,metadata:{prompt:a.prompt,model:b,resolution:d,aspectRatio:e,cost:i,generationTime:0}}}catch(a){if(console.error("‚ùå Firebase Function Error:",a),a.message?.includes("unauthenticated"))throw Error("You must be logged in to generate videos.");if(a.message?.includes("resource-exhausted"))throw Error("Insufficient credits. Please purchase more credits to continue.");throw Error(a.message||"Failed to start video generation")}}async getVideoStatus(a,b){try{let c=(0,f.httpsCallable)(this.functions,"checkReplicateVideoStatus"),d=(await c({predictionId:a,videoId:b})).data;console.log(`üìä Video status for ${a}:`,d.status);let e="";d.output&&("string"==typeof d.output?e=d.output:Array.isArray(d.output)&&d.output.length>0&&(e=d.output[0]));let g=0;return"starting"===d.status?g=10:"processing"===d.status?g=50:"succeeded"===d.status?g=100:"failed"===d.status&&(g=0),{id:a,url:e,thumbnail:e?this.generateThumbnail(e):"",duration:0,status:this.mapStatus(d.status),progress:g,metadata:{prompt:"",model:"",resolution:"",aspectRatio:"",cost:0,generationTime:d.metrics?.predict_time||0}}}catch(a){throw console.error("Error retrieving video status:",a.message),a}}async waitForCompletion(a,b=12e5){let c=Date.now();for(console.log(`‚è≥ Waiting for video ${a} (max ${b/1e3}s)`);Date.now()-c<b;){let b=await this.getVideoStatus(a);if("completed"===b.status)return console.log("‚úÖ Video generation completed:",a),b;if("failed"===b.status)throw console.error("‚ùå Video generation failed:",a),Error("Video generation failed");let d=Date.now()-c;d%3e4<3e3&&console.log(`‚è±Ô∏è Video ${a} still processing... (${Math.round(d/1e3)}s elapsed)`),await new Promise(a=>setTimeout(a,3e3))}throw console.error("‚è±Ô∏è Video generation timed out after",b/1e3,"seconds"),Error(`Video generation timed out after ${b/1e3} seconds`)}async cancelGeneration(a,b){try{let c=(0,f.httpsCallable)(this.functions,"cancelReplicateVideo");await c({predictionId:a,videoId:b}),console.log(`Video generation ${a} canceled`)}catch(a){throw console.error("Error canceling generation:",a.message),a}}calculateCost(a,b,c){return this.PRICING[a]&&this.PRICING[a][c]?parseFloat((this.PRICING[a][c]*b).toFixed(2)):(console.warn(`No pricing data for ${a} at ${c}`),0)}mapStatus(a){switch(a){case"starting":default:return"pending";case"processing":return"processing";case"succeeded":return"completed";case"failed":case"canceled":return"failed"}}generateThumbnail(a){return`https://picsum.photos/seed/${Date.now()}/800/450`}async generateVariations(a,b){let c=[];for(let d of b){let b={...a,prompt:d},e=await this.generateVideo(b);c.push(e)}return c}getPricingInfo(){return{models:Object.keys(this.MODELS),pricing:this.PRICING,description:{"seedance-1-lite":"Budget-friendly option, good for drafts and previews","seedance-1-pro":"Higher quality with better dynamic range and realism"}}}validateParams(a){let b=[];return a.prompt&&0!==a.prompt.trim().length||b.push("Prompt is required"),a.duration&&(a.duration<2||a.duration>12)&&b.push("Duration must be between 2 and 12 seconds"),a.resolution&&!["480p","720p","1080p"].includes(a.resolution)&&b.push("Resolution must be 480p, 720p, or 1080p"),a.aspectRatio&&!["16:9","4:3","1:1","3:4","9:16","21:9","9:21"].includes(a.aspectRatio)&&b.push("Invalid aspect ratio"),{valid:0===b.length,errors:b}}}function i(){let a=(0,d.useRouter)(),[f,g]=(0,c.useState)([]),[i,j]=(0,c.useState)(!0),[k,l]=(0,c.useState)(0),[m,n]=(0,c.useState)("Initializing Replicate API..."),[o,p]=(0,c.useState)(null),q=h.getInstance();(0,c.useEffect)(()=>{let b=new URLSearchParams(window.location.search).get("campaignId");if(!b){console.error("‚ùå No campaign ID provided"),alert("Campaign not found. Please create a new campaign."),a.push("/generate");return}let c=`campaign_${b}`,d=localStorage.getItem(c);if(!d){console.error("‚ùå Campaign data not found for ID:",b),alert("Campaign data not found. Please create a new campaign."),a.push("/generate");return}try{let a=JSON.parse(d);console.log("üöÄ Starting Replicate video generation with params:",a),console.log("üìã Campaign ID:",b),p(a);let c=a.variations||2,e=a.duration||6;(async()=>{let b,d,f,h=(b=a.brandTone||"professional",d=a.productName,f=a.productDescription,d?[`${b} cinematic opening: ${d} displayed prominently. ${f}. Professional lighting, clean composition, high-quality presentation, product-focused establishing shot. Camera: smooth tracking shot, 24fps cinematic`,`${b} detail sequence: Close-up highlights of ${d} features and benefits. ${f}. Dynamic camera movement, smooth transitions, emphasis on quality and craftsmanship. Camera: medium shot with movement, 30fps`,`${b} lifestyle moment: ${d} in real-world usage scenario showing product value. ${f}. Authentic presentation, professional quality, engaging composition. Camera: wide to close-up, 24fps cinematic`].slice(0,c):(console.error("‚ùå Product name is required"),[])),i=[];n("Connecting to Replicate API..."),l(10);for(let b=0;b<Math.min(c,h.length);b++){let c={portrait:"9:16",landscape:"16:9",square:"1:1"},d=a.orientation||"portrait",f={prompt:h[b]||`Generate ${a.productName||"product"} video ad scene ${b+1}`,duration:e,aspectRatio:c[d],resolution:a.resolution||"720p",model:a.videoModel||"seedance-1-lite"},g=await q.generateVideo(f);i.push({id:g.id,url:"",thumbnail:"",status:"generating",progress:0,duration:e,metadata:{productName:a.productName||"Product",brandTone:a.brandTone||"professional",orientation:a.orientation||"portrait",resolution:a.resolution||"720p",prompt:h[b],model:f.model,cost:g.metadata.cost}})}g(i),n("Video generation started - this may take 10-20 minutes per video..."),l(20);let k=async(a,b)=>{try{console.log(`üé¨ Starting to poll video ${b+1}/${i.length}`);let c=await q.waitForCompletion(a.id,12e5);g(b=>b.map(b=>b.id===a.id?{...b,url:c.url||"",thumbnail:c.thumbnail||`https://picsum.photos/seed/${a.id}/400/600`,status:"completed",progress:100}:b)),console.log(`‚úÖ Video ${b+1}/${i.length} completed`)}catch(b){console.error(`‚ùå Error generating video ${a.id}:`,b),g(b=>b.map(b=>b.id===a.id?{...b,status:"failed",progress:0}:b))}};await Promise.allSettled(i.map((a,b)=>k(a,b))),n("Video generation complete!"),l(100),j(!1)})()}catch(b){console.error("‚ùå Error initializing campaign:",b),alert("Error loading campaign data. Please try again."),a.push("/generate")}},[a]);let r=async a=>{let b=f[a];if(!b)return;g(b=>b.map((b,c)=>c===a?{...b,status:"generating",progress:0}:b));let c={prompt:b.metadata.prompt||`Regenerate ${b.metadata.productName} video scene`,duration:b.duration,aspectRatio:{portrait:"9:16",landscape:"16:9",square:"1:1"}[b.metadata.orientation]||"16:9",resolution:b.metadata.resolution,model:b.metadata.model||"seedance-1-lite"};try{let b=await q.generateVideo(c),d=await q.waitForCompletion(b.id);g(c=>c.map((c,e)=>e===a?{...c,id:b.id,status:"completed",progress:100,url:d.url||"",thumbnail:d.thumbnail||`https://picsum.photos/seed/${b.id}/400/600`}:c))}catch(b){console.error("Error regenerating video:",b),g(b=>b.map((b,c)=>c===a?{...b,status:"failed"}:b))}};return(0,b.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100",children:[(0,b.jsx)("nav",{className:"bg-white shadow-sm",children:(0,b.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,b.jsxs)("div",{className:"flex justify-between h-16",children:[(0,b.jsx)("div",{className:"flex items-center",children:(0,b.jsx)("h1",{className:"text-xl font-semibold text-gray-900",children:"Replicate Video Generation"})}),(0,b.jsx)("div",{className:"flex items-center space-x-4",children:(0,b.jsx)(e.default,{href:"/dashboard",className:"text-sm text-gray-500 hover:text-gray-700",children:"Back to Dashboard"})})]})})}),(0,b.jsxs)("main",{className:"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8",children:[i&&(0,b.jsx)("div",{className:"mb-6 px-4",children:(0,b.jsxs)("div",{className:"bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg p-6 text-white",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h2",{className:"text-2xl font-bold mb-2",children:"üé¨ Generating with Replicate"}),(0,b.jsx)("p",{className:"text-lg opacity-90",children:m})]}),(0,b.jsxs)("div",{className:"text-right",children:[(0,b.jsxs)("div",{className:"text-3xl font-bold",children:[k,"%"]}),(0,b.jsx)("div",{className:"text-sm opacity-75",children:"Complete"})]})]}),(0,b.jsx)("div",{className:"w-full bg-white/20 rounded-full h-4",children:(0,b.jsx)("div",{className:"bg-white h-4 rounded-full transition-all duration-500 flex items-center justify-end pr-2",style:{width:`${k}%`},children:k>10&&(0,b.jsx)("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-pulse"})})}),(0,b.jsxs)("div",{className:"mt-4 grid grid-cols-3 gap-4 text-sm",children:[(0,b.jsxs)("div",{className:"bg-white/10 rounded p-2",children:[(0,b.jsx)("div",{className:"opacity-75",children:"Model"}),(0,b.jsx)("div",{className:"font-semibold",children:"Seedance"})]}),(0,b.jsxs)("div",{className:"bg-white/10 rounded p-2",children:[(0,b.jsx)("div",{className:"opacity-75",children:"Est. Time"}),(0,b.jsx)("div",{className:"font-semibold",children:"~10 seconds"})]}),(0,b.jsxs)("div",{className:"bg-white/10 rounded p-2",children:[(0,b.jsx)("div",{className:"opacity-75",children:"Quality"}),(0,b.jsx)("div",{className:"font-semibold",children:"1080p HD"})]})]})]})}),(0,b.jsxs)("div",{className:"px-4",children:[(0,b.jsxs)("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:["Generated ",o?.productName||"Campaign"," Videos (",f.length,")"]}),(0,b.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:f.map((a,c)=>(0,b.jsxs)("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[(0,b.jsx)("div",{className:"aspect-[9/16] relative bg-gray-100",children:"completed"===a.status?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("video",{src:a.url,poster:a.thumbnail,controls:!0,className:"w-full h-full object-cover",children:"Your browser does not support the video tag."}),(0,b.jsxs)("div",{className:"absolute top-2 right-2 bg-green-500 text-white px-2 py-1 rounded text-xs flex items-center gap-1",children:[(0,b.jsx)("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20",children:(0,b.jsx)("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),"Replicate AI"]})]}):(0,b.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),(0,b.jsx)("p",{className:"mt-2 text-sm text-gray-600",children:"Generating with Replicate..."}),(0,b.jsxs)("p",{className:"text-xs text-gray-500",children:[a.progress,"%"]})]})})}),(0,b.jsxs)("div",{className:"p-4",children:[(0,b.jsxs)("h3",{className:"font-semibold text-gray-900",children:["Scene ",c+1,": ",0===c?"Opening":1===c?"Action":"Finale"]}),(0,b.jsxs)("div",{className:"mt-2 space-y-1 text-sm text-gray-600",children:[(0,b.jsx)("p",{className:"line-clamp-2 text-xs",children:a.metadata.prompt}),(0,b.jsxs)("div",{className:"flex items-center gap-2 mt-2",children:[(0,b.jsx)("span",{className:"bg-gray-100 px-2 py-1 rounded text-xs",children:a.metadata.model}),(0,b.jsx)("span",{className:"bg-gray-100 px-2 py-1 rounded text-xs",children:a.metadata.resolution}),(0,b.jsxs)("span",{className:"bg-gray-100 px-2 py-1 rounded text-xs",children:[a.duration,"s"]})]}),a.metadata.cost&&(0,b.jsxs)("p",{className:"text-green-600 font-semibold",children:["$",a.metadata.cost]})]}),(0,b.jsx)("div",{className:"mt-4 flex space-x-2",children:"completed"===a.status&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("button",{onClick:()=>{window.open(a.url,"_blank")},className:"flex-1 bg-blue-600 text-white px-3 py-2 rounded-md text-sm hover:bg-blue-700",children:"Download"}),(0,b.jsx)("button",{onClick:()=>r(c),className:"flex-1 bg-gray-100 text-gray-700 px-3 py-2 rounded-md text-sm hover:bg-gray-200",children:"Regenerate"})]})})]})]},a.id))})]}),!i&&f.length>0&&(0,b.jsx)("div",{className:"mt-8 px-4",children:(0,b.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Video Generation Complete ‚ú®"}),(0,b.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-gray-500",children:"Total Videos"}),(0,b.jsx)("p",{className:"font-semibold text-lg",children:f.length})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-gray-500",children:"Generation Time"}),(0,b.jsx)("p",{className:"font-semibold text-lg",children:"10 seconds"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-gray-500",children:"Total Cost"}),(0,b.jsxs)("p",{className:"font-semibold text-lg text-green-600",children:["$",f.reduce((a,b)=>a+(b.metadata.cost||0),0).toFixed(2)]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-gray-500",children:"Quality"}),(0,b.jsx)("p",{className:"font-semibold text-lg",children:"1080p HD"})]})]}),(0,b.jsxs)("div",{className:"mt-6 p-4 bg-blue-50 rounded-lg",children:[(0,b.jsxs)("h4",{className:"font-semibold text-blue-900 mb-2",children:["üéØ ",o?.productName||"Campaign"," Ready"]}),(0,b.jsxs)("p",{className:"text-sm text-blue-700",children:["Your ",o?.brandTone||"professional"," ",o?.productName||"campaign"," videos have been generated using Replicate's Seedance model. Each scene was crafted according to your specifications with high-quality output, professional editing, and dynamic presentation as requested."]})]}),(0,b.jsxs)("div",{className:"mt-6 flex space-x-4",children:[(0,b.jsx)("button",{onClick:()=>a.push("/generate?new=true"),className:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700",children:"Generate New Campaign"}),(0,b.jsx)("button",{onClick:()=>a.push("/dashboard"),className:"bg-gray-100 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-200",children:"Back to Dashboard"})]})]})})]})]})}a.s(["default",()=>i],10855)}];

//# sourceMappingURL=marin_vid_ad_app_generate_results_page_tsx_ec31eb15._.js.map